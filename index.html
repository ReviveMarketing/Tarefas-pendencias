<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Tarefas Pós-Venda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .filter-btn-active { background-color: #4f46e5 !important; color: white !important; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-indigo-600 text-white pt-8 pb-24 shadow-lg">
        <div class="container mx-auto px-4 md:px-8 max-w-5xl flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">Painel de Tarefas Pós-Venda</h1>
                <p class="text-indigo-200 mt-1">Administração das pendências de clientes "FECHADO".</p>
            </div>
            <button id="refresh-button" class="p-2 rounded-full hover:bg-indigo-500 transition-colors duration-300" title="Atualizar Tarefas">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
            </button>
        </div>
    </header>

    <div class="container mx-auto max-w-5xl px-4 md:px-8 -mt-16">
        <div class="bg-white rounded-lg shadow-xl p-4 md:p-6 mb-6">
            <div id="stats-section">
                <span class="text-sm font-medium text-gray-500">Total de Pendências</span>
                <div class="mt-1">
                    <span id="stats-summary" class="text-2xl font-bold text-indigo-600">0</span>
                </div>
            </div>
        </div>
        
        <main id="task-list" class="space-y-4">
            <!-- As tarefas serão carregadas aqui -->
        </main>

        <div id="empty-state" class="hidden text-center py-12 bg-white rounded-lg shadow-xl">
            <h3 id="empty-state-title" class="mt-4 text-xl font-semibold text-gray-800"></h3>
            <p id="empty-state-subtitle" class="text-gray-500 mt-2"></p>
        </div>

        <div id="loading-state" class="text-center py-12 bg-white rounded-lg shadow-xl">
            <p>Carregando tarefas da planilha...</p>
        </div>
        
        <div id="error-state" class="hidden text-center bg-red-50 p-8 rounded-lg">
             <h3 class="text-xl font-semibold text-red-800">Erro ao carregar as tarefas.</h3>
             <p class="text-red-600 mt-2">Verifique se o link do App Script está correto e implantado para "Qualquer pessoa".</p>
        </div>
    </div>
    
    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbywnKpGYzXlm1eBbVMySkbSnswGScmJ-AnIj1VaTnCojhaWMYD7_wSHq2gFTak0iZSI/exec';

        const taskListEl = document.getElementById('task-list');
        const emptyStateEl = document.getElementById('empty-state');
        const loadingStateEl = document.getElementById('loading-state');
        const errorStateEl = document.getElementById('error-state');
        const refreshButton = document.getElementById('refresh-button');
        const emptyStateTitleEl = document.getElementById('empty-state-title');
        const emptyStateSubtitleEl = document.getElementById('empty-state-subtitle');
        const statsSummaryEl = document.getElementById('stats-summary');
        
        async function fetchTasks() {
            loadingStateEl.classList.remove('hidden');
            errorStateEl.classList.add('hidden');
            emptyStateEl.classList.add('hidden');
            taskListEl.innerHTML = '';
            
            try {
                const response = await fetch(WEB_APP_URL);
                if (!response.ok) throw new Error('Erro na resposta da rede.');
                
                const tasks = await response.json();
                
                loadingStateEl.classList.add('hidden');
                statsSummaryEl.textContent = tasks.length;
                
                if (tasks.length === 0) {
                    emptyStateEl.classList.remove('hidden');
                    taskListEl.classList.add('hidden');
                    emptyStateTitleEl.textContent = 'Nenhuma pendência encontrada';
                    emptyStateSubtitleEl.textContent = 'Não há leads com status "FECHADO" em Outubro ou Setembro.';
                } else {
                    taskListEl.classList.remove('hidden');
                    tasks.forEach(task => {
                        const taskEl = createTaskElement(task);
                        taskListEl.appendChild(taskEl);
                    });
                }

            } catch (error) {
                console.error("Erro ao buscar tarefas:", error);
                loadingStateEl.classList.add('hidden');
                errorStateEl.classList.remove('hidden');
            }
        }

        refreshButton.addEventListener('click', fetchTasks);
        
        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = `task-card bg-white p-5 rounded-lg shadow-sm border flex items-start space-x-4`;
            
            div.innerHTML = `
                <span class="mt-1.5 flex-shrink-0 w-3 h-3 bg-yellow-500 rounded-full" title="Pendente"></span>
                <div class="flex-grow">
                    <p class="font-bold text-lg text-gray-800">${task.leadName}</p>
                    <p class="text-sm text-gray-500">ID da Linha na Planilha: ${task.id}</p>
                </div>
            `;
            return div;
        }
        
        fetchTasks();
    </script>
</body>
</html>
